%option noyywrap

%{
FILE *f;
%}

ALPHA 			[A-Za-z]
DIGIT 			[1-6]

OPENER			<
CLOSER			>

STARTML			(?i:"oubegin")
ENDML			(?i:"ouend")

NEW_LINE		(?i:"nl")

STRING			(^(<>))

TEXT_COLOR		(?i:"text color=")
COLOR			((?i:"red")|(?i:"blue")|(?i:"black"))

BEGIN_HEADING_MARK  (?i:"h")
END_HEADING_MARK    (?i:"/h")		

START_CENTER		(?i:"c")
END_CENTER			(?i:"/c")

BEGIN_BOLD		(?i:"bold")    
END_BOLD		(?i:"/bold")                      

BEGIN_COMMENT	("<!! "|"<!!")
END_COMMENT   	(" !!>")|("!!>")

BEGIN_NUMBER_BULLET		(?i:"bln")
END_NUMBER_BULLET		(?i:"/bln")                                 

BEGIN_REGULAR_BULLET    (?i:"bl")
END_REGULAR_BULLET      (?i:"/bl")

BEGIN_ITALICS_MARK		(?i:"it")
END_ITALICS_MARK		(?i:"/it")

%%

{OPENER}{STARTML}{CLOSER}		        fprintf(yyout, "startML\n", yytext);fprintf(f, "startML \t%s\n", yytext);
{OPENER}{ENDML}{CLOSER}                 fprintf(yyout, "endML\n", yytext);fprintf(f, "endML \t%s\n", yytext);

{OPENER}{NEW_LINE}{CLOSER}	          	fprintf(yyout, "newline\n",yytext);fprintf(f, "newline \t\t%s\n", yytext); 

{STRING}*								fprintf(yyout, "string\n",yytext);fprintf(f, "string \t%s\n", yytext);

{OPENER}{TEXT_COLOR}{COLOR}{CLOSER}		fprintf(yyout, "set_text_color\n", yytext);fprintf(f, "set_text_color \t %s \t	Color %.5c\n", yytext, yytext[12]);

{OPENER}{BEGIN_HEADING_MARK}{DIGIT}{CLOSER}	    fprintf(yyout, "begin_heading_mark\n", yytext);fprintf(f, "begin_heading_mark \t%s \t Size %c\n", yytext, yytext[2]);	
{OPENER}{END_HEADING_MARK}{DIGIT}{CLOSER}	    fprintf(yyout, "end_heading_mark\n", yytext);fprintf(f, "end_heading_mark \t%s \t Size %c\n", yytext, yytext[3]);

{OPENER}{START_CENTER}{CLOSER}			fprintf(yyout, "start_center\n", yytext);fprintf(f, "start_center \t%s\n", yytext);
{OPENER}{END_CENTER}{CLOSER}			fprintf(yyout, "end_center\n", yytext);fprintf(f, "end_center \t%s\n", yytext);

{OPENER}{BEGIN_BOLD}{CLOSER}			fprintf(yyout, "begin_bold\n", yytext);fprintf(f, "begin_bold \t%s\n", yytext);
{OPENER}{END_BOLD}{CLOSER}				fprintf(yyout, "end_bold\n", yytext);fprintf(f, "end_bold \t%s\n", yytext);

{BEGIN_COMMENT}							fprintf(yyout, "begin_comment\n", yytext);fprintf(f, "begin_comment \t%s\n", yytext);
{END_COMMENT}							fprintf(yyout, "end_comment\n", yytext);fprintf(f, "end_comment \t%s\n", yytext);

{OPENER}{BEGIN_ITALICS_MARK}{CLOSER}	fprintf(yyout, "begin_italics_mark\n", yytext);fprintf(f, "begin_italics_mark \t%s\n", yytext);
{OPENER}{END_ITALICS_MARK}{CLOSER}		fprintf(yyout, "end_italics_mark\n", yytext);fprintf(f, "end_italics_mark \t%s\n", yytext);

{OPENER}{BEGIN_NUMBER_BULLET}{CLOSER}	fprintf(yyout, "begin_number_bullet\n", yytext);fprintf(f, "begin_number_bullet \t%s\n", yytext);
{OPENER}{END_NUMBER_BULLET}{CLOSER}		fprintf(yyout, "end_number_bullet\n", yytext);fprintf(f, "end_number_bullet \t%s\n", yytext);

{OPENER}{BEGIN_REGULAR_BULLET}{CLOSER}			fprintf(yyout, "begin_regular_bullet\n", yytext);fprintf(f, "begin_regular_bullet \t%s\n", yytext);
{OPENER}{END_REGULAR_BULLET}{CLOSER}			fprintf(yyout, "end_regular_bullet\n", yytext);fprintf(f, "end_regular_bullet \t%s\n", yytext);

{OPENER}								fprintf(yyout, "Unrecognized char: %s\n", yytext);
{CLOSER}								fprintf(yyout, "Unrecognized char: %s\n", yytext);

.										fprintf(yyout, "string %s\n", yytext); fprintf(f, "string %s\n", yytext);



%%

int main(int argc, char **argv ){

	++argv, --argc;  /* skip over program name */
	f = fopen("output.tok", "w");
	fprintf(f, "%-30s %-30s %0s", "TOKEN", "LEXEME", "ATTRIBUTES\n");
	
	if ( argc > 0 )
		yyin = fopen( argv[0], "r" );
	else
		yyin = stdin;

	if ( argc > 1 )
		f = fopen( argv[1], "w" );
	else
		yyout = stdout;

yylex();
}
